trigger:
  branches:
    include:
      - main  # Adjust as necessary

pool:
  vmImage: 'ubuntu-latest'

variables:
  - group: azure_credential  # Variable group containing CLIENT_ID, CLIENT_SECRET, etc.

stages:
  - stage: Terraform_Deploy
    displayName: 'Terraform Apply'
    jobs:
      - job: Terraform
        displayName: 'Run Terraform'
        timeoutInMinutes: 10
        steps:
          - checkout: self

          # Install Terraform using built-in Azure DevOps task
          - task: TerraformInstaller@0
            inputs:
              terraformVersion: 'latest'
            displayName: 'Install Terraform'

          # Initialize Terraform
          - script: |
              terraform init
            displayName: 'Terraform Init'
            workingDirectory: $(Build.SourcesDirectory)

          # Run Terraform Plan (optional but recommended)
          - script: |
              terraform plan -out=tfplan \
                -var "subscription_id=$(SUBSCRIPTION_ID)" \
                -var "client_id=$(CLIENT_ID)" \
                -var "client_secret=$(CLIENT_SECRET)" \
                -var "tenant_id=$(TENANT_ID)"
            displayName: 'Terraform Plan'
            workingDirectory: $(Build.SourcesDirectory)

          # Apply Terraform changes
          - script: |
              terraform apply -auto-approve tfplan
            displayName: 'Terraform Apply'
            workingDirectory: $(Build.SourcesDirectory)




























